function getTrueOffsetLeft(ele)
{
 var n = 0;
 while (ele)
 {
  n += ele.offsetLeft || 0;
  ele = ele.offsetParent;
 }
 return n;
}
    
function getTrueOffsetTop(ele)
{
 var n = 0;
 while (ele)
 {
  n += ele.offsetTop || 0;
  ele = ele.offsetParent;
 }
 return n;
}

function getMouse(e, obj)
{
 var x = e.clientX - getTrueOffsetLeft(obj) + window.pageXOffset;
 var y = e.clientY - getTrueOffsetTop(obj) + window.pageYOffset;
 return [x,y];
}
    
function scrollDown(id)
{
 document.getElementById(id).scrollTop += 10;
 scrollYdelta = (document.getElementById(id).scrollHeight-(document.getElementById(id).offsetHeight));
 widthScrollArrows = document.getElementById(id+'ScrollDown').offsetHeight*2;
 posYScroller = ((document.getElementById(id).offsetHeight-widthScrollArrows)/scrollYdelta)*
                  document.getElementById(id).scrollTop +document.getElementById(id+'ScrollDown').offsetHeight;
 
 if (posYScroller>(document.getElementById(id).offsetHeight - 
                   document.getElementById(id+'ScrollDown').offsetHeight -
                   document.getElementById(id+'Scroller').offsetHeight))
     posYScroller=document.getElementById(id).offsetHeight-document.getElementById(id+'ScrollDown').offsetHeight-document.getElementById(id+'Scroller').offsetHeight;
 
 document.getElementById(id+'Scroller').style.top = posYScroller+"px";
 document.getElementById(id+'ScrollBox').style.top = document.getElementById(id).scrollTop + "px";

}

function scrollUp()
{
 document.getElementById(id).scrollTop -= 10;
 scrollYdelta = (document.getElementById(id).scrollHeight-(document.getElementById(id).offsetHeight));
 widthScrollArrows = document.getElementById(id+'ScrollDown').offsetHeight*2;
 posYScroller = ((document.getElementById(id).offsetHeight-widthScrollArrows)/scrollYdelta)*
                  document.getElementById(id).scrollTop + document.getElementById(id+'ScrollDown').offsetHeight;
 document.getElementById(id+'Scroller').style.top = posYScroller+"px";
 document.getElementById(id+'ScrollBox').style.top = document.getElementById(id).scrollTop + "px";
}
   
function onMouseWheelScroll(e)
{
 id = this.id;       
 e = e || event;   
 if (!e.wheelDelta)
 {
  e.wheelDelta = -40*e.detail; // для Firefox
 }
 document.getElementById(id).scrollTop -= e.wheelDelta;
 widthScrollArrows = document.getElementById(id+'ScrollDown').offsetHeight*2;
 scrollYdelta = (document.getElementById(id).scrollHeight-(document.getElementById(id).offsetHeight));
 posYScroller = ((document.getElementById(id).offsetHeight-widthScrollArrows)/scrollYdelta)*
                  document.getElementById(id).scrollTop + document.getElementById(id+'ScrollDown').offsetHeight;
 
 if (posYScroller>(document.getElementById(id).offsetHeight - 
                   document.getElementById(id+'ScrollDown').offsetHeight -
                   document.getElementById(id+'Scroller').offsetHeight))
     posYScroller=document.getElementById(id).offsetHeight-document.getElementById(id+'ScrollDown').offsetHeight-document.getElementById(id+'Scroller').offsetHeight;
 
 document.getElementById(id+'ScrollBox').style.top = document.getElementById(id).scrollTop + "px";
 document.getElementById(id+'Scroller').style.top =  posYScroller+"px";
}
   
function onMouseScrollDown (e,id)
{
 e = e || event;   
 mouse = getMouse(e, document.getElementById(id+'ScrollBody'));
 mouse[1]= mouse[1]+document.getElementById(id).scrollTop;
 posYScroller = mouse[1];
 widthScrollArrows = document.getElementById(id+'ScrollDown').offsetHeight*2;
 scrollYdelta = (document.getElementById(id).scrollHeight-(document.getElementById(id).offsetHeight-widthScrollArrows));
 document.getElementById(id).scrollTop = (posYScroller-document.getElementById(id+'ScrollDown').offsetHeight)/
                                         ((document.getElementById(id).offsetHeight-widthScrollArrows)/scrollYdelta);
 document.getElementById(id+'ScrollBox').style.top = document.getElementById(id).scrollTop + "px";
 document.getElementById(id+'Scroller').style.top =  posYScroller+"px";
}    
    
function addScroller(element)
{
 id=element.id;
 src='<div id="'+id+'ScrollBox" class="scrollBox">\n\
      <div id="'+id+'Scroller" class="scroller"></div>\n\
      <div id="'+id+'ScrollUp" class="scrollUp" onmousedown="scrollUp(\''+id+'\')"></div>\n\
      <div id="'+id+'ScrollBody" class="scrollBody" onmousedown="onMouseScrollDown(event,\''+id+'\')"></div>\n\
      <div id="'+id+'ScrollDown" class="scrollDown" onmousedown="scrollDown(\''+id+'\')"></div>';  

 jsText = 'document.getElementById("'+id+'").addEventListener ("mousewheel", onMouseWheelScroll, false);\n\
 document.getElementById("'+id+'").addEventListener ("DOMMouseScroll", onMouseWheelScroll, false);';

 js = document.createElement('script');
 js.setAttribute('type', 'text/javascript');
 js.setAttribute('defer', 'defer');
 js.innerHTML = jsText;
 element.innerHTML=element.innerHTML+src+"</div><div id='scrollJS'></div>";
 document.getElementById('scrollJS').appendChild(js);

}
function removeScroller(element){
id=element.id;
if(document.getElementById(id+'ScrollBox')!==null){ 
    document.getElementById(id+'ScrollBox').remove(); 
    document.getElementById('scrollJS').remove();    
  }
}